# 16 ‚Äî SIEM 101 üîê

## Learning Objectives üéØ

- Understand SIEM architecture and workflow
- Learn log collection methods (agents vs agentless)
- Understand log aggregation, parsing, and storage
- Create effective SIEM alerts using blacklist/whitelist/long tail analysis

---

## What is SIEM? üéØ

**Definition**: Security Information and Event Management - collects and interprets organizational data to detect threats in real-time.

**SOC Analyst Role**: Review potential threats detected by SIEM (alerts on monitoring dashboards).

**Top Commercial SIEM** (Gartner 2021): Splunk, IBM QRadar, LogRhythm, Exabeam, RSA NetWitness, etc.

---

## SIEM Architecture Flow üìä

```
[Log Sources] ‚Üí [Log Agents/Agentless] ‚Üí [Log Aggregator] ‚Üí [Storage] ‚Üí [Alert Engine] ‚Üí [SOC Analyst]
```

**Key Components**:
1. Log Collection (agents or agentless)
2. Log Aggregation & Parsing (filter, modify, enrich)
3. Log Storage (WORM-based, indexed)
4. Alerting (rule-based detection)

---

## 1. Log Collection üì•

### What is a Log?

**Definition**: File recording events in OS, software, or network communications.

**Basic Log Components**: Timestamp, Source System, Message

**Example**: `/var/log/auth.log` (Ubuntu)
```
Nov 27 10:24:15 server1 sshd[1234]: Failed password for admin from 192.168.1.50
```

**Goal**: Transfer logs from various sources (hosts, firewalls, servers, proxies) to SIEM for centralized threat detection.

---

## Log Collection Methods

| Method | How | Pros | Cons |
|--------|-----|------|------|
| **Agents** | Install software on source systems | Parsing, encryption, buffering, tested | Resource usage, install/update cost |
| **Agentless** | SSH/WMI with credentials | No install, easy to manage | Credential theft risk, limited features |
| **Custom Scripts** | Manual API/script collection | Works for unsupported sources | Requires development effort |

### Syslog Protocol

**Purpose**: Network protocol for log transfers (UDP/TCP port 514, optional TLS)

**Format**: `Timestamp - Source - Facility - Severity - Message`

**Limits**: UDP = 1024 bytes, TCP = 4096 bytes

**Devices**: Switches, Routers, IDS, Firewalls, Linux, Mac, Windows (with software)

### Popular Agents

**Commercial**: Splunk Universal Forwarder, ArcSight Connectors
**Open Source**: Beats (Elastic), NXLog

---

## 2. Log Aggregation & Parsing üîÑ

**Purpose**: Process logs before storage (filter, modify, enrich).

### EPS (Events Per Second)

**Formula**: `EPS = Events / Time (seconds)` ‚Üí Example: 1000 logs/5s = **200 EPS**

**Impact**: Higher EPS = need more aggregators + storage. Scale with multiple aggregators.

### Aggregator Processing

| Process | Purpose | Example |
|---------|---------|---------|
| **Modification** | Normalize formats | Convert date: `mm-dd-yyyy` ‚Üí `dd-mm-yyyy`, timezone: `UTC+2` ‚Üí `UTC+1` |
| **Parsing** | Extract fields | Break raw log into IP, timestamp, action fields |
| **Filtering** | Send only relevant logs | Only errors, not info logs |
| **Enrichment** | Add context | Add geolocation, DNS resolution, tags |

### Log Enrichment Types

- **Geolocation**: `192.168.1.50` ‚Üí Add "United States, New York"
- **DNS**: `142.250.186.142` ‚Üí Add "google.com" (or reverse DNS)
- **Add/Remove Fields**: Add tags/priorities, remove PII

---

## 3. Log Storage üíæ

**Common Mistake**: Focus on size, ignore search speed.

**Critical**: Fast search > large capacity (15-min search = unusable).

### WORM (Write Once Read Many)

**Purpose**: SIEM logs written once, never edited.

| Database Type | Optimized For | SIEM Speed |
|---------------|---------------|------------|
| **MySQL/Traditional** | CRUD (add/edit/delete) | Slow (15 min) ‚ùå |
| **WORM/Indexed** | Write once, read many | Fast (< 1s) ‚úÖ |

**Why WORM**: Logs don't need editing - only fast indexing and retrieval.

---

## 4. Alerting üö®

**Purpose**: Detect abnormal behavior, alert SOC analysts.

**Requirements**: Timely (fast storage), Optimized (low false positives), Actionable

**Creation Methods**: Scheduled queries OR real-time streaming

**Example Alerts**: User added to admin group | 15 failed logins in 3 min | First-time suspicious domain

---

## Alert Techniques üîç

| Technique | Definition | Example | Pros | Cons |
|-----------|------------|---------|------|------|
| **Blacklist** ‚ö´ | Block known bad items | Alert on `mimikatz.exe` | Easy to implement | Easy to bypass (rename file) |
| **Whitelist** ‚ö™ | Allow only known good | Alert if IP NOT in approved list | Catches unknowns | Hard to maintain, high false positives |
| **Long Tail** üìà | Rare events = suspicious | Event 4624 (10k/day) = normal<br>Event 4720 (2/month) = suspicious | Catches anomalies, adapts | Needs baseline, slow attacks blend in |

**Long Tail Visual**:
```
High Freq: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  ‚Üê Normal (ignore)
Low Freq:  ‚ñà            ‚Üê Investigate!
```

**Reference**: https://threatpost.com/long-tail-analysis-hope-cybercrime-battle/155992/

---

## Alert Best Practices üéØ

1. ‚úÖ Understand data before creating alerts
2. ‚úÖ Combine techniques (blacklist + whitelist + long tail)
3. ‚úÖ Tune regularly (reduce false positives)
4. ‚úÖ Prioritize (Critical/High/Medium/Low)
5. ‚úÖ Context matters (1 failed login ‚â† 15 in 3 min)
6. ‚úÖ Correlate logs (firewall + IDS + DNS)
7. ‚úÖ Baseline first (know normal)
8. ‚úÖ Test before production

---

## SIEM Workflow Summary üìã

| Stage | Purpose | Key Actions |
|-------|---------|-------------|
| **1. Collection** | Gather logs | Install agents or configure agentless |
| **2. Aggregation** | Process logs | Parse, filter, enrich (geo, DNS) |
| **3. Storage** | Store logs | Use WORM/indexed storage for fast search |
| **4. Alerting** | Detect threats | Create rules (blacklist/whitelist/long tail) |
| **5. Investigation** | Analyze alerts | SOC analysts review and respond |

---

## SOC Focus Points üéØ

1. ‚úÖ **Agent vs Agentless**: Agents = more features, Agentless = easier but risky credentials
2. ‚úÖ **EPS Matters**: High EPS requires scaling (multiple aggregators)
3. ‚úÖ **Enrichment**: Add geolocation/DNS at aggregation stage = saves investigation time
4. ‚úÖ **Storage Speed**: Fast search > large storage (15min search = unusable)
5. ‚úÖ **WORM Storage**: Write once, read many = optimized for SIEM
6. ‚úÖ **Blacklist**: Easy to bypass (change filename/IP) but simple to implement
7. ‚úÖ **Whitelist**: Effective but hard to maintain (constant updates)
8. ‚úÖ **Long Tail**: Focus on rare events = catch anomalies
9. ‚úÖ **Alert Tuning**: Reduce false positives or analysts will ignore alerts
10. ‚úÖ **Correlation**: Single log type insufficient - combine firewall + IDS + DNS + proxy

---

*Note: Module 16 SIEM 101 provides foundational understanding of SIEM architecture, log collection methods, and alerting techniques essential for SOC analysts.*
