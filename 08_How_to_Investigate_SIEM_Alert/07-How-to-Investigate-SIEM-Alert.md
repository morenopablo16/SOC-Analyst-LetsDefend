# 07 ‚Äî How to Investigate a SIEM Alert üö®

## Learning Objectives üéØ

- Understand SIEM alert detection and monitoring workflow
- Master the alert investigation process from ownership to closure
- Learn playbook-driven investigation methodology
- Perform comprehensive email, network, and endpoint analysis
- Apply proper containment and documentation practices

---

## Key Concepts üí°

### 1. SIEM Alerts Overview

**Definition**: Notifications generated by SIEM systems based on predefined rules and correlation algorithms customized to meet organization's specific security requirements.

**Alert Coverage**: Range from common attacks used by adversaries to sophisticated zero-day exploits (prepared and updated by cybersecurity experts).

**Benefits of Alert Resolution**:
- Improved analysis skills (advanced techniques for threat identification)
- Tool familiarity (hands-on experience with SOC tools)
- Log analysis expertise (locate logs, detect malicious activity)
- Improved incident response (swift, effective response)
- Enhanced threat intelligence (insight into evolving threats)
- Continuous improvement (stay prepared for emerging threats)

### 2. Monitoring Page Structure

**Three Main Sections**:

1. **Main Channel**
   - Default view displaying all open incidents available for ownership
   - Key fields:
     - **Severity**: Low, Medium, High, Critical
     - **Date**: Incident date (UTC +0 timezone)
     - **Rule Name**: Specific rule triggered by event
     - **EventID**: Unique identifier for event
     - **Type**: Event/alert type
     - **Action**: Assign ownership for investigation
   - Filter options: Severity, Type, Role criteria

2. **Investigation Channel**
   - Manages active alerts assigned to you
   - Create cases for detailed investigation
   - Initiate playbooks for guided analysis

3. **Closed Alerts**
   - Review completed investigations
   - Access playbook answers and analysis details
   - View official incident reports and community walkthroughs

### 3. Playbooks

**Definition**: Pre-arranged series of instructions guiding you through investigation processes for effective and consistent alert analysis.

**Purpose**: Different alert types (web attacks, ransomware, malware, phishing) require different investigation methods and approaches.

**Why Playbooks Are Important**:
- Provide clear, step-by-step investigation process
- Help analysts who don't always know exact steps to take
- Essential for new analysts starting SOC careers
- Ensure consistency across investigations
- Automatically assigned when case is created

### 4. Investigation Workflow

**Step-by-Step Process**:

1. **Take Ownership**
   - Click on alert to access details
   - Use "Take ownership" option
   - Alert automatically sent to Investigation Channel

2. **Create Case**
   - Navigate to Investigation Channel
   - Select assigned alert
   - Click "Create a Case" button
   - Opens Case Management page immediately

3. **Launch Playbook**
   - View Incident Details on Case Management page
   - Click "Start Playbook" button
   - Keep playbook tab open at all times
   - Follow pre-defined instructions

4. **Conduct Analysis**
   - Email analysis
   - Network and log analysis
   - Endpoint analysis
   - Threat intelligence checks

5. **Close Alert**
   - Determine True Positive vs. False Positive
   - Document findings in Analyst Note
   - Include reasoning, relevant data, steps taken
   - Review closed alert details

---

## Investigation Methodology üîé

### Email Analysis

**Playbook Step: Parse Email**

**Gather Key Details**:
- Sender information
- Recipient information
- Time/date
- Suspicious content
- Attachments

**Navigate to Email Security**:
1. Click Email Security tab
2. Use detailed search bar with fields:
   - Sender
   - Recipient
   - Subject
   - Sender IP Address
   - Attachment Name
   - Email Body
   - Date
   - Action

**Examine Email Content**:
- Review email body for suspicious content
- Check sender information authenticity
- Identify attachments
- Look for hyperlinks/URLs
- Scroll down to view attachments

**Check for Attachments/URLs**:
- Look at bottom of email for attached files
- Review email body text for hyperlinks
- Hyperlinks can lead to malicious websites/downloads

### URL/Attachment Analysis

**Critical Step**: Analyze attachments or URLs using third-party sandboxes to safely check if content is malicious.

**Important Note**: Use virtual machine to download attachments (they may contain malware). Password for zip files is always **"infected"** unless stated otherwise.

**Recommended Tools**:
- **AnyRun**: Interactive malware analysis service, sandbox
- **VirusTotal**: Analyzes files and URLs for viruses
- **URLHouse**: Database of malicious URLs
- **URLScan**: Tool for scanning and analyzing websites
- **HybridAnalysis**: Free malware analysis service

**Alternative**: Use LetsDefend sandbox machines for static analysis (contain malware analysis tools, safe to use).

**Analysis Steps**:
1. Download attachment(s)
2. Analyze using provided tools
3. Determine if malicious or non-malicious
4. Document findings

### Email Delivery Status

**Check Device Action**:
- Navigate to Alert Details page
- Find "Device Action" section
- Look for email delivery indicators:
  - **"Allowed"**: Email reached user (Delivered)
  - **"Blocked"** or **"Quarantined"**: Email intercepted (Not Delivered)

**Containment Action**:
If email was delivered and is malicious:
1. Navigate to Email Security tab
2. Locate suspicious email
3. Click on email to open detailed view
4. Click "Delete" button (top right)
5. Document action taken

### Network and Log Analysis

**Purpose**: Determine if malicious URLs were accessed or if user executed downloaded files.

**Steps to Follow**:

1. **Find Affected Host IP Address**
   - Go to Endpoint Security page
   - Search for hostname
   - Review "Host Information"
   - Note IP address

2. **Navigate to Log Management**
   - Switch to "Basic" mode
   - Enter IP address in search bar
   - View all connections from host

3. **Analyze Log Entries**
   - Focus on "SRC ADDRESS" and "DEST ADDRESS" columns
   - Identify suspicious connections
   - Review unusual outbound connections/data transfers
   - Click "Raw Data" button for detailed log view
   - Look for communication with C2 servers

**Threat Intelligence Check**:
- Use Threat Intel tab to analyze IOCs
- Aggregates data from various threat intelligence sources
- Search for suspicious IP addresses, domains, or URLs
- Review results for known malicious activity
- Note findings

### Endpoint Analysis

**Purpose**: Examine processes, terminal, and browser activity on affected endpoints to identify indicators of compromise.

**Endpoint Security Overview**: Operates as EDR system (like Carbon Black, SentinelOne, CrowdStrike), collecting log data and providing insight into host activity.

**Steps to Follow**:

1. **Navigate to Endpoint Security**
   - Search for host by IP address or hostname
   - Review host information (hostname, IP, OS, last login)

2. **Process and Network Action Analysis**
   - Check running processes for suspicious activity
   - Dive deeper into suspicious process details
   - Examine parent and child processes
   - Analyze suspicious process HASH on Threat Intel platforms
   - Check network activity during alert time frame
   - Note unusual inbound/outbound connections (C2 communication)
   - Cross-reference IOCs on threat intel platforms

3. **Terminal History Analysis**
   - Check for suspicious commands executed
   - Look for signs of unauthorized actions
   - Identify unusual command patterns

4. **Browser History Analysis**
   - Examine visits to malicious websites
   - Check for download links clicked
   - Identify potentially dangerous file downloads

### Containment

**Why Containment is Necessary**:
- Prevent data loss
- Prevent unauthorized access
- Prevent lateral movement
- Prevent data extortion

**Quick Implementation**: Vital in preventing further damage to system after identifying IOCs.

---

## Alert Closure Process üìù

### Determine Alert Classification

**True Positive**: Alert is legitimate and requires further action
**False Positive**: Alert is a false alarm

### Document Findings

**Analyst Note Should Include**:
- Reasoning behind decision (True Positive/False Positive)
- Relevant data or observations
- Steps taken during investigation
- IOCs identified
- Actions performed (email deletion, containment, etc.)

### Review Process

**After Closing Alert**:
1. Review details in "Closed Alerts" section
2. Verify playbook answers provided
3. Confirm accurate assessment
4. Access official incident report or community walkthrough
5. Gain additional context around alert
6. Learn from investigation process

**Case Management Review**:
- Review closed alerts in Case Management
- See alert details and analysis options chosen
- Reference for future similar incidents

---

## Quick Reference üìã

### Investigation Checklist

```
‚ñ° Take ownership of alert
‚ñ° Create case in Investigation Channel
‚ñ° Start playbook
‚ñ° Parse email (sender, recipient, time, content, attachments)
‚ñ° Analyze URLs/attachments with sandboxes
‚ñ° Check email delivery status (Device Action)
‚ñ° Delete malicious email if delivered
‚ñ° Find affected host IP address (Endpoint Security)
‚ñ° Analyze logs (Log Management - Basic mode)
‚ñ° Check for C2 connections in logs
‚ñ° Query IOCs in Threat Intel tab
‚ñ° Analyze endpoint processes
‚ñ° Review network actions
‚ñ° Check terminal history
‚ñ° Check browser history
‚ñ° Implement containment measures
‚ñ° Document all findings
‚ñ° Close alert with proper classification
‚ñ° Write comprehensive Analyst Note
```

### Key Platforms/Tabs in LetsDefend

| Platform/Tab | Purpose |
|--------------|---------|
| **Monitoring Page** | View/filter alerts, take ownership |
| **Email Security** | Search, analyze, delete emails |
| **Log Management** | Analyze network connections, identify C2 |
| **Endpoint Security** | Process/terminal/browser analysis, host info |
| **Threat Intel** | Query IOCs, check malicious indicators |
| **Case Management** | Review closed cases, playbook answers |
| **Sandbox** | Safe malware analysis environment |

### Severity Levels

- **Critical**: Immediate action required, high-impact threat
- **High**: Significant threat, requires prompt attention
- **Medium**: Moderate threat, investigate thoroughly
- **Low**: Minor threat, standard investigation

---

## SOC Focus Points üéØ

1. **Always Use Virtual Machines**: Download attachments only in VMs or sandboxes
2. **Keep Playbook Tab Open**: Reference instructions throughout investigation
3. **Document Everything**: Take notes in text file during investigation
4. **Default Zip Password**: Always "infected" unless stated otherwise
5. **Time Zone Awareness**: Alert dates in UTC +0 timezone
6. **Device Action is Key**: Determines if email reached user (containment decision)
7. **Cross-Reference IOCs**: Always check Threat Intel for known malicious indicators
8. **Parent/Child Processes**: Examine full process tree, not just suspicious process
9. **Raw Log Data**: Click "Raw Data" for complete log details
10. **Community Learning**: Review official reports and walkthroughs after closing alerts

---

## Practical Example: Phishing Alert Investigation üé£

**Alert**: EventID: 257 - SOC282 - Phishing Alert - Deceptive Mail Detected

**Investigation Flow**:
1. Take ownership ‚Üí Create case ‚Üí Start playbook
2. Parse email (sender, recipient, time, suspicious content)
3. Check attachments/URLs ‚Üí Analyze with VirusTotal/AnyRun
4. Check Device Action ‚Üí Determine if delivered
5. Delete email from recipient mailbox (if delivered)
6. Find host IP ‚Üí Analyze logs for C2 connections
7. Check Threat Intel for IOCs
8. Analyze endpoint (processes, terminal, browser history)
9. Implement containment
10. Close alert with True Positive classification
11. Document comprehensive Analyst Note

